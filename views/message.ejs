<%- include('./shared/headers.ejs') %>

    <title><%= session.name %> | Sarahah</title>
    
    <div class="container py-5">
        <div class="profile-card bg-white p-4 p-md-5 text-center mb-5">
            <div class="avatar-container mb-4">
                <a href="#" data-bs-toggle="modal" data-bs-target="#profileModal">
                    <img src="<%= photo || '../public/img/avatar.png' %>" class="avatar" alt="Profile Photo">
                </a>
            </div>
            <h2 class="mb-3 fw-bold"><%= session.name %></h2>
            <button class="share-btn mb-4" data-bs-toggle="modal" data-bs-target="#shareModal">
                <i class="fas fa-share-alt me-2"></i> Share Profile
            </button>
            
            <div class="d-flex justify-content-center gap-3">
                <div class="stat-box p-3 rounded">
                    <h4 class="mb-0"><%= messages.length %></h4>
                    <small class="text-muted">Messages</small>
                </div>
            </div>
        </div>

        <h3 class="text-center mb-4">Your Messages</h3>
        
        <% if (!messages.length) { %>
            <div class="empty-state text-center py-5">
                <i class="fas fa-comment-slash text-muted mb-3" style="font-size: 3rem;"></i>
                <h4 class="mb-3">No messages yet</h4>
                <p class="text-muted">Share your profile to start receiving messages</p>
            </div>
        <% } else { %>
            <div class="row g-4">
                <% messages.forEach(message => { %>
                    <div class="col-md-6">
                        <div class="message-card p-4 bg-white">
                            <p class="mb-3"><%= message.message %></p>
                            <small class="text-muted">
                                <i class="far fa-clock me-1"></i> 
                                <%= new Date(message.createdAt).toLocaleString('en-EG', { 
                                    year: 'numeric', 
                                    month: 'short', 
                                    day: 'numeric', 
                                    hour: '2-digit', 
                                    minute: '2-digit' 
                                }) %>
                            </small>
                        </div>
                    </div>
                <% }); %>
            </div>
        <% } %>
    </div>

    <!-- Profile Photo Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Update Profile Photo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="uploadPhotoForm" action="/user/upload-photo" method="post" enctype="multipart/form-data">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Select new photo (max 7MB)</label>
                            <input type="file" class="form-control" name="photo" accept="image/*" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-upload me-1"></i> Upload
                        </button>
                        <button type="submit" formaction="/user/remove-photo" formmethod="post" 
                                class="btn btn-outline-danger" onclick="document.querySelector('[name=photo]').removeAttribute('required')">
                            <i class="fas fa-trash-alt me-1"></i> Remove Photo
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Share Profile Modal -->
    <div class="modal fade" id="shareModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Share Your Profile</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <div class="mb-4">
                        <p class="mb-2">Your profile link:</p>
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" value="<%= url %>" id="profileLink" readonly>
                            <button class="btn btn-primary" onclick="copyToClipboard()">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    <div class="mb-3">
                        <p class="mb-3">Scan QR code to share:</p>
                        <img src="<%= qrCode %>" class="qr-code img-fluid" alt="QR Code">
                    </div>
                    <div class="social-share mt-4">
                        <p class="mb-2">Share via:</p>
                        <div class="d-flex justify-content-center gap-3">
                            <a href="https://wa.me/?text=Send%20me%20anonymous%20messages%20on%20Sarahah:%20<%= encodeURIComponent(url) %>" 
                               class="btn btn-success" target="_blank">
                                <i class="fab fa-whatsapp"></i>
                            </a>
                            <a href="https://twitter.com/intent/tweet?text=Send%20me%20anonymous%20messages%20on%20Sarahah:%20<%= encodeURIComponent(url) %>" 
                               class="btn btn-info text-white" target="_blank">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a href="https://www.facebook.com/sharer/sharer.php?u=<%= encodeURIComponent(url) %>" 
                               class="btn btn-primary" target="_blank">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<%- include('./shared/footer.ejs') %>
